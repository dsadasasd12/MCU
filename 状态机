
> ğŸ’­ å—¯ï¼Œç”¨æˆ·é—®çš„æ˜¯å…³äºå•ç‰‡æœºçŠ¶æ€æœºä»£ç çš„Cè¯­è¨€å®ç°ã€‚é¦–å…ˆï¼Œæˆ‘å¾—ç¡®å®šç”¨æˆ·çš„éœ€æ±‚æ˜¯ä»€ä¹ˆã€‚ä»–ä»¬å¯èƒ½æ­£åœ¨å­¦ä¹ å•ç‰‡æœºç¼–ç¨‹ï¼Œæˆ–è€…éœ€è¦åœ¨å®é™…é¡¹ç›®ä¸­å®ç°çŠ¶æ€æœºã€‚çŠ¶æ€æœºåœ¨å•ç‰‡æœºä¸­å¾ˆå¸¸è§ï¼Œæ¯”å¦‚å¤„ç†æŒ‰é”®è¾“å…¥ã€é€šä¿¡åè®®è§£ææˆ–è€…ä»»åŠ¡è°ƒåº¦ç­‰ã€‚
> ç”¨æˆ·å¯èƒ½å·²ç»å¯¹çŠ¶æ€æœºæœ‰ä¸€å®šçš„äº†è§£ï¼Œä½†éœ€è¦å…·ä½“çš„ä»£ç ç¤ºä¾‹å’Œç»“æ„è¯´æ˜ã€‚æˆ‘åº”è¯¥æä¾›ä¸€ä¸ªç®€å•æ˜äº†çš„ä¾‹å­ï¼Œé€‚åˆå•ç‰‡æœºç¯å¢ƒï¼Œæ¯”å¦‚ä½¿ç”¨switch-caseç»“æ„æˆ–è€…å‡½æ•°æŒ‡é’ˆæ•°ç»„ã€‚è€ƒè™‘åˆ°å•ç‰‡æœºçš„èµ„æºæœ‰é™ï¼Œä»£ç åº”è¯¥é«˜æ•ˆä¸”èŠ‚çœå†…å­˜ã€‚
> æ¥ä¸‹æ¥ï¼Œéœ€è¦ç¡®å®šçŠ¶æ€æœºçš„ç±»å‹ã€‚åŸºæœ¬çš„çŠ¶æ€æœºæœ‰Mooreæœºå’ŒMealyæœºï¼Œè¿™é‡Œå¯èƒ½éœ€è¦ä¸€ä¸ªé€šç”¨çš„æ¡†æ¶ï¼Œè®©ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç®€å•çš„LEDé—ªçƒæˆ–è€…æŒ‰é”®æ£€æµ‹çš„çŠ¶æ€æœºä¾‹å­ä¼šæ¯”è¾ƒç›´è§‚ã€‚
> è¿˜è¦è€ƒè™‘çŠ¶æ€è½¬ç§»çš„æ–¹å¼ã€‚æ˜¯å¦ä½¿ç”¨æšä¸¾æ¥å®šä¹‰çŠ¶æ€ï¼Œç”¨ç»“æ„ä½“æˆ–è€…äºŒç»´æ•°ç»„æ¥ç»´æŠ¤çŠ¶æ€è¡¨ã€‚å¯èƒ½ç”¨æˆ·éœ€è¦çš„æ˜¯éé˜»å¡å¼çŠ¶æ€æœºï¼Œè¿™æ ·åœ¨å•ç‰‡æœºä¸­ä¸ä¼šå ç”¨å¤ªå¤šå¤„ç†æ—¶é—´ã€‚
> å¦å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›ä»£ç æœ‰æ³¨é‡Šï¼Œç»“æ„æ¸…æ™°ï¼Œæ–¹ä¾¿ç†è§£ã€‚å¯èƒ½éœ€è¦è§£é‡Šæ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ï¼Œæ¯”å¦‚çŠ¶æ€å®šä¹‰ã€äº‹ä»¶å¤„ç†ã€çŠ¶æ€è½¬ç§»æ¡ä»¶ç­‰ã€‚åŒæ—¶ï¼Œæ˜¯å¦éœ€è¦ä½¿ç”¨å®šæ—¶å™¨æ¥é©±åŠ¨çŠ¶æ€æœºï¼Œæˆ–è€…åŸºäºäº‹ä»¶é©±åŠ¨çš„æ–¹å¼ã€‚
> å¯èƒ½éœ€è¦æåˆ°çŠ¶æ€æœºçš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚æé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚å¯¹äºå•ç‰‡æœºæ¥è¯´ï¼ŒçŠ¶æ€æœºå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¤æ‚çš„æµç¨‹ï¼Œé¿å…ä½¿ç”¨é˜»å¡å»¶è¿Ÿå‡½æ•°ï¼Œæé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚
> ä¹Ÿæœ‰å¯èƒ½ç”¨æˆ·é‡åˆ°çš„é—®é¢˜æ˜¯å…³äºçŠ¶æ€æœºå®ç°çš„å¸¸è§é”™è¯¯ï¼Œæ¯”å¦‚çŠ¶æ€é—æ¼ã€æ¡ä»¶åˆ¤æ–­é”™è¯¯ï¼Œæˆ–è€…çŠ¶æ€è½¬ç§»é€»è¾‘æ··ä¹±ã€‚æ‰€ä»¥åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œéœ€è¦æ³¨æ„è¿™äº›ç‚¹ï¼Œç¡®ä¿é€»è¾‘æ­£ç¡®ï¼Œç»“æ„æ¸…æ™°ã€‚
> æœ€åï¼Œå¯èƒ½éœ€è¦æé†’ç”¨æˆ·æ ¹æ®å…·ä½“çš„ç¡¬ä»¶å’Œéœ€æ±‚è°ƒæ•´ä»£ç ï¼Œæ¯”å¦‚æ›¿æ¢GPIOæ“ä½œå‡½æ•°ï¼Œæˆ–è€…è°ƒæ•´å»¶æ—¶æ—¶é—´ã€‚ç¡®ä¿ç¤ºä¾‹ä»£ç èƒ½å¤Ÿç›´æ¥è¿è¡Œï¼Œæˆ–è€…ç”¨æˆ·èƒ½å¤Ÿè½»æ¾ä¿®æ”¹é€‚é…è‡ªå·±çš„å¼€å‘ç¯å¢ƒã€‚
> 

ä»¥ä¸‹æ˜¯å•ç‰‡æœºçŠ¶æ€æœºï¼ˆFinite State Machine, FSMï¼‰çš„Cè¯­è¨€å®ç°ç¤ºä¾‹ï¼ŒåŒ…å«åŸºæœ¬æ¡†æ¶å’Œæ³¨é‡Šè¯´æ˜ï¼š

```c
#include <stdio.h>

/* çŠ¶æ€å®šä¹‰ */
typedef enum {
    STATE_IDLE,     // ç©ºé—²çŠ¶æ€
    STATE_RUNNING,  // è¿è¡ŒçŠ¶æ€
    STATE_ERROR,    // é”™è¯¯çŠ¶æ€
    STATE_COUNT      // çŠ¶æ€æ€»æ•°ï¼ˆä¿æŒæœ€åï¼‰
} SystemState;

/* äº‹ä»¶å®šä¹‰ */
typedef enum {
    EVENT_START,     // å¯åŠ¨äº‹ä»¶
    EVENT_STOP,      // åœæ­¢äº‹ä»¶
    EVENT_ERROR,     // é”™è¯¯äº‹ä»¶
    EVENT_RESET,     // å¤ä½äº‹ä»¶
    EVENT_COUNT      // äº‹ä»¶æ€»æ•°ï¼ˆä¿æŒæœ€åï¼‰
} SystemEvent;

/* çŠ¶æ€å¤„ç†å‡½æ•°æŒ‡é’ˆ */
typedef void (*StateHandler)(void);

/* çŠ¶æ€å¤„ç†å‡½æ•°å£°æ˜ */
void HandleIdleState(void);
void HandleRunningState(void);
void HandleErrorState(void);

/* çŠ¶æ€è½¬ç§»è¡¨ */
const StateHandler stateHandlers[STATE_COUNT] = {
    HandleIdleState,
    HandleRunningState,
    HandleErrorState
};

/* å…¨å±€çŠ¶æ€å˜é‡ */
static SystemState currentState = STATE_IDLE;

/* äº‹ä»¶å¤„ç†å‡½æ•° */
void ProcessEvent(SystemEvent event) {
    switch(currentState) {
        case STATE_IDLE:
            if(event == EVENT_START) {
                printf("Transition: IDLE -> RUNNING\n");
                currentState = STATE_RUNNING;
            }
            break;
            
        case STATE_RUNNING:
            if(event == EVENT_STOP) {
                printf("Transition: RUNNING -> IDLE\n");
                currentState = STATE_IDLE;
            } else if(event == EVENT_ERROR) {
                printf("Transition: RUNNING -> ERROR\n");
                currentState = STATE_ERROR;
            }
            break;
            
        case STATE_ERROR:
            if(event == EVENT_RESET) {
                printf("Transition: ERROR -> IDLE\n");
                currentState = STATE_IDLE;
            }
            break;
            
        default:
            break;
    }
}

/* çŠ¶æ€å¤„ç†å‡½æ•°å®ç° */
void HandleIdleState(void) {
    // ç©ºé—²çŠ¶æ€ä¸‹çš„æ“ä½œ
    printf("In IDLE state\n");
    // ä¾‹å¦‚ï¼šä½åŠŸè€—æ¨¡å¼ã€ç­‰å¾…æŒ‡ä»¤ç­‰
}

void HandleRunningState(void) {
    // è¿è¡ŒçŠ¶æ€ä¸‹çš„æ“ä½œ
    printf("In RUNNING state\n");
    // ä¾‹å¦‚ï¼šæ‰§è¡Œä¸»è¦ä»»åŠ¡ã€é‡‡é›†æ•°æ®ç­‰
}

void HandleErrorState(void) {
    // é”™è¯¯çŠ¶æ€å¤„ç†
    printf("In ERROR state\n");
    // ä¾‹å¦‚ï¼šé”™è¯¯æ¢å¤ã€æŠ¥è­¦ç­‰
}

/* ä¸»å¾ªç¯ */
int main(void) {
    while(1) {
        // 1. æ‰§è¡Œå½“å‰çŠ¶æ€çš„å¤„ç†å‡½æ•°
        stateHandlers[currentState]();
        
        // 2. æ¨¡æ‹Ÿäº‹ä»¶äº§ç”Ÿï¼ˆå®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºå®é™…äº‹ä»¶æ£€æµ‹ï¼‰
        static int counter = 0;
        counter++;
        
        if(counter == 1) ProcessEvent(EVENT_START);
        if(counter == 3) ProcessEvent(EVENT_ERROR);
        if(counter == 5) ProcessEvent(EVENT_RESET);
        if(counter == 7) ProcessEvent(EVENT_STOP);
        
        // ç®€å•å»¶æ—¶ï¼ˆå®é™…é¡¹ç›®ä¸­ä½¿ç”¨å®šæ—¶å™¨ï¼‰
        for(int i=0; i<1000000; i++);
    }
    return 0;
}
```

### ä»£ç è¯´æ˜ï¼š
1. **çŠ¶æ€å®šä¹‰**ï¼šä½¿ç”¨æšä¸¾æ˜ç¡®ç³»ç»ŸçŠ¶æ€ï¼ŒSTATE_COUNTç”¨äºè‡ªåŠ¨è®¡ç®—çŠ¶æ€æ€»æ•°
2. **äº‹ä»¶é©±åŠ¨**ï¼šé€šè¿‡äº‹ä»¶è§¦å‘çŠ¶æ€è½¬ç§»ï¼Œäº‹ä»¶å¯ä»¥æ¥è‡ªå¤–éƒ¨ä¸­æ–­ã€å®šæ—¶å™¨æˆ–ä¼ æ„Ÿå™¨ç­‰
3. **çŠ¶æ€å¤„ç†å‡½æ•°**ï¼šæ¯ä¸ªçŠ¶æ€æœ‰ç‹¬ç«‹å¤„ç†å‡½æ•°ï¼ŒåŒ…å«è¯¥çŠ¶æ€çš„æŒç»­è¡Œä¸º
4. **çŠ¶æ€è½¬ç§»è¡¨**ï¼šé€šè¿‡å‡½æ•°æŒ‡é’ˆæ•°ç»„å®ç°å¿«é€ŸçŠ¶æ€å¤„ç†
5. **éé˜»å¡è®¾è®¡**ï¼šé€‚åˆå•ç‰‡æœºå®æ—¶ç³»ç»Ÿéœ€æ±‚

### æ‰©å±•å»ºè®®ï¼š
1. æ·»åŠ çŠ¶æ€è¿›å…¥/é€€å‡ºåŠ¨ä½œ
2. å¢åŠ çŠ¶æ€ä¿æŒæ—¶é—´ç»Ÿè®¡
3. ä½¿ç”¨äºŒç»´æ•°ç»„å®ç°æ›´å¤æ‚çš„è½¬ç§»è¡¨ï¼š
```c
typedef struct {
    SystemState nextState;
    void (*action)(void);
} StateTransition;

const StateTransition stateTable[STATE_COUNT][EVENT_COUNT] = {
    /* STATE_IDLE */
    {
        {STATE_RUNNING, StartAction},   // EVENT_START
        {STATE_IDLE, NULL},             // EVENT_STOP
        // ...å…¶ä»–äº‹ä»¶å¤„ç†
    },
    // ...å…¶ä»–çŠ¶æ€
};
```

### å•ç‰‡æœºåº”ç”¨æ³¨æ„äº‹é¡¹ï¼š
1. é¿å…åœ¨çŠ¶æ€å¤„ç†ä¸­ä½¿ç”¨é˜»å¡å»¶æ—¶ï¼ˆç”¨å®šæ—¶å™¨æ›¿ä»£ï¼‰
2. äº‹ä»¶æ£€æµ‹å»ºè®®æ”¾åœ¨ä¸­æ–­æœåŠ¡ç¨‹åºä¸­
3. å¯¹äºæ—¶é—´æ•æ„Ÿçš„çŠ¶æ€è½¬ç§»ï¼Œä½¿ç”¨ç¡¬ä»¶å®šæ—¶å™¨
4. æ·»åŠ çœ‹é—¨ç‹—æœºåˆ¶å¢å¼ºå¯é æ€§
5. å…³é”®çŠ¶æ€å¯æŒä¹…åŒ–å­˜å‚¨ï¼ˆEEPROM/Flashï¼‰

å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´çŠ¶æ€è½¬ç§»é€»è¾‘å’Œå¤„ç†å‡½æ•°å†…å®¹ï¼Œè¿™ç§æ¶æ„é€‚ç”¨äºæŒ‰é”®æ‰«æã€é€šä¿¡åè®®è§£æã€ç³»ç»Ÿæ¨¡å¼åˆ‡æ¢ç­‰åœºæ™¯ã€‚
